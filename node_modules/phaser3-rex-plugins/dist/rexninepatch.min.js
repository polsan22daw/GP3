!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexninepatch=e()}(void 0,function(){function F(t){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=i.key,"symbol"==typeof(o=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0===r)return("string"===e?String:Number)(t);var i=r.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(n,"string"))?o:String(o)),i)}var n,o}function r(t,e,r){return e&&i(t.prototype,e),r&&i(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function c(i){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=o(i);if(n){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return a(this,t)}}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}}).apply(this,arguments)}function T(t){var e,r,i;if(null==t||"object"!==F(t))return t;if(e=Array.isArray(t)?[]:{},function(t){if("object"!==F(t)||t.nodeType||t===t.window)return!1;try{if(t.constructor&&!{}.hasOwnProperty.call(t.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0}(t))for(i in t)r=t[i],e[i]=T(r);else e=t;return e}function t(){}function h(t,w){var e=function(){n(g,t);var b=c(g);function g(t,e,r,i,n,o,s,a,c,u){var h;if(x(this,g),P(e)?(e=S(u=e,"x",0),r=S(u,"y",0),i=S(u,"width",1),n=S(u,"height",1),o=S(u,"key",void 0),s=S(u,"baseFrame",void 0),a=S(u,"columns",void 0),c=S(u,"rows",void 0)):P(i)?(i=S(u=i,"width",1),n=S(u,"height",1),o=S(u,"key",void 0),s=S(u,"baseFrame",void 0),a=S(u,"columns",void 0),c=S(u,"rows",void 0)):P(o)?(o=S(u=o,"key",void 0),s=S(u,"baseFrame",void 0),a=S(u,"columns",void 0),c=S(u,"rows",void 0)):P(s)?(s=S(u=s,"baseFrame",void 0),a=S(u,"columns",void 0),c=S(u,"rows",void 0)):Array.isArray(s)?(u=c,c=a,a=s,s=S(u,"baseFrame",void 0)):P(a)&&(a=S(u=a,"columns",void 0),c=S(u,"rows",void 0)),void 0===a){var l=S(u,"leftWidth",void 0),f=S(u,"rightWidth",void 0);void 0!==l&&void 0!==f&&(a=[l,void 0,f])}if(void 0===c){var d=S(u,"topHeight",void 0),m=S(u,"bottomHeight",void 0);void 0!==d&&void 0!==m&&(c=[d,void 0,m])}(h=b.call(this,t)).type=w,h.setPosition(e,r).setSize(i,n).setOrigin(.5,.5),h.columns={},h.rows={},h.stretchMode={},h._tileSprite=void 0,h._image=void 0,h.setGetFrameNameCallback(S(u,"getFrameNameCallback",void 0)),h.setStretchMode(S(u,"stretchMode",0)),h.setPreserveRatio(S(u,"preserveRatio",!0));var p=S(u,"maxFixedPartScale",1),y=S(u,"maxFixedPartScaleX",p),v=S(u,"maxFixedPartScaleY",void 0);return h.setMaxFixedPartScale(y,v),h.setBaseTexture(o,s,a,c),h}return r(g,[{key:"minWidth",get:function(){return this.columns.minWidth}},{key:"minHeight",get:function(){return this.rows.minHeight}},{key:"fixedPartScaleX",get:function(){return this.columns.scale}},{key:"fixedPartScaleY",get:function(){return this.rows.scale}},{key:"resize",value:function(t,e){return this.width===t&&this.height===e||(u(o(g.prototype),"resize",this)?u(o(g.prototype),"resize",this).call(this,t,e):u(o(g.prototype),"setSize",this).call(this,t,e),this.updateTexture()),this}}]),g}();return Object.assign(e.prototype,g),e}function e(t){return t instanceof w}function l(t){return t instanceof O}function f(t){return null==t||"object"!==F(t)?null:e(t)?t:e(t.game)?t.game:l(t)?t.sys.game:l(t.scene)?t.scene.sys.game:void 0}function d(t,e){if(_||(_={},f(t).events.once("destroy",function(){for(var t in _)_[t].destroy();_=void 0})),!_.hasOwnProperty(e)){var r=f(t).scene.systemScene;(t=new j[e](r)).setOrigin(0),_[e]=t}return _[e]}var m=function(t,e,r){return"__BASE"===r?"".concat(t,",").concat(e):"".concat(r,"_").concat(t,",").concat(e)},p=Phaser.Utils.Objects.IsPlainObject,y=Phaser.Utils.Objects.GetValue,v=function(t){return"string"==typeof t&&(t=b[t]),t},b={scale:0,repeat:1},g={_beginDraw:t,_drawImage:t,_drawTileSprite:t,_endDraw:t,setGetFrameNameCallback:function(t){return void 0===t&&(t=m),this.getFrameNameCallback=t,this},setBaseTexture:function(t,e,r,i,n,o){Array.isArray(e)&&(i=r,r=e,e=void 0),null==e&&(e="__BASE"),i="number"==typeof r&&6<=arguments.length?(r=[r,void 0,i],[n,void 0,o]):(r=T(r),T(i)),this.textureKey=t,this.baseFrameName=e,this.columns.data=r,this.columns.count=r?r.length:0,this.columns.stretch=0,this.columns.minWidth=0,this.columns.scale=1,this.rows.data=i,this.rows.count=i?i.length:0,this.rows.stretch=0,this.rows.minHeight=0,this.rows.scale=1;var s=this.scene.sys.textures.get(t);if(!s)return this.clear(),this;if(!r||!i)return this.clear(),this;for(var a=s.get(e),c=a.width,u=0,h=0,l=r.length;h<l;h++)void 0===r[h]?u++:"number"==typeof r[h]?c-=r[h]:c-=r[h].width;var f=c/u,d=a.height,m=0;for(h=0,l=i.length;h<l;h++)void 0===i[h]?m++:"number"==typeof i[h]?d-=i[h]:d-=i[h].width;for(var p,y,v,b,g,w=d/m,x=0,P=0,S=0,O=i.length;S<O;S++){void 0===i[S]&&(i[S]=w),"number"==typeof i[S]&&(i[S]={height:i[S],stretch:S%2}),v=(p=i[S]).height,this.rows.stretch+=0|p.stretch,this.rows.minHeight+=0<p.stretch?0:v;h=x=0;for(var j=r.length;h<j;h++){if(void 0===r[h]&&(r[h]=f),"number"==typeof r[h]&&(r[h]={width:r[h],stretch:h%2}),b=(y=r[h]).width,0===S&&(this.columns.stretch+=0|y.stretch,this.columns.minWidth+=0<y.stretch?0:b),1<=b&&1<=v){var _=F(g=this.getFrameNameCallback(h,S,e));"string"!==_&&"number"!==_||s.add(g,0,x+a.cutX,P+a.cutY,b,v)}x+=b}P+=v}return this.updateTexture(),this},updateTexture:function(){if(this.clear(),void 0===this.textureKey)return this;var t=this.scene.sys.textures.get(this.textureKey);if(!t)return this;var e,r,i,n,o,s,a,c=this.columns.minWidth*this.maxFixedPartScaleX,u=this.rows.minHeight*this.maxFixedPartScaleY,h=this.width-c,l=this.height-u,f=0<=h?this.maxFixedPartScaleX:this.width/c,d=0<=l?this.maxFixedPartScaleY:this.height/u;if(this.preserveRatio){var m=Math.min(f,d);if(m<f){var p=(f-m)*c;0<=h?h+=p:h=p,f=m}if(m<d){var y=(d-m)*u;0<=l?l+=y:l=y,d=m}}this.columns.scale=f,this.rows.scale=d,e=0<h&&0<this.columns.stretch?h/this.columns.stretch:0,r=0<l&&0<this.rows.stretch?l/this.rows.stretch:0;var v=0,b=0;this._beginDraw();for(var g=0,w=this.rows.count;g<w;g++){a=0===(o=this.rows.data[g]).stretch?o.height*d:r*o.stretch;for(var x=v=0,P=this.columns.count;x<P;x++)s=0===(n=this.columns.data[x]).stretch?n.width*f:e*n.stretch,i=this.getFrameNameCallback(x,g,this.baseFrameName),t.has(i)&&0<s&&0<a&&(0===(0===o.stretch&&0===n.stretch||0===this.getStretchMode(x,g)?0:1)?this._drawImage(this.textureKey,i,v,b,s,a):this._drawTileSprite(this.textureKey,i,v,b,s,a)),v+=s;b+=a}this._endDraw()},setStretchMode:function(t){return p(t)?(this.stretchMode.edge=v(y(t,"edge",0)),this.stretchMode.internal=v(y(t,"internal",0))):(t=v(t),this.stretchMode.edge=t,this.stretchMode.internal=t),this},getStretchMode:function(t,e){return function(t,e){return 0===t||t===this.columns.count-1||0===e||e===this.rows.count-1}.call(this,t,e)?this.stretchMode.edge:this.stretchMode.internal},setPreserveRatio:function(t){return null==t&&(t=!0),this.preserveRatio=t,this},setMaxFixedPartScale:function(t,e){return void 0===e&&(e=t),this.maxFixedPartScaleX=t,this.maxFixedPartScaleY=e,this}},P=Phaser.Utils.Objects.IsPlainObject,S=Phaser.Utils.Objects.GetValue,w=Phaser.Game,O=Phaser.Scene,j=Phaser.GameObjects,_=void 0,k=Phaser.GameObjects.RenderTexture,M=function(){n(e,h(k,"rexNinePatch"));var t=c(e);function e(){return x(this,e),t.apply(this,arguments)}return r(e)}(),R={_beginDraw:k.prototype.beginDraw,_endDraw:k.prototype.endDraw,_drawImage:function(t,e,r,i,n,o){var s=d(this,"Image").setTexture(t,e).setDisplaySize(n,o);this.batchDraw(s,r,i)},_drawTileSprite:function(t,e,r,i,n,o){var s=d(this,"TileSprite").setTexture(t,e).setSize(n,o);this.batchDraw(s,r,i)}};return Object.assign(M.prototype,R),M});
