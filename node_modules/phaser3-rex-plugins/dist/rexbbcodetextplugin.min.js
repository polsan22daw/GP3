!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rexbbcodetextplugin=e()}(void 0,function(){function l(t){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(r=i.key,"symbol"==typeof(s=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(r,"string"))?s:String(s)),i)}var r,s}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&n(t,e)}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function v(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function h(i){var r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e=a(i);if(r){var n=a(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return v(t)}(this,t)}}function P(t){return function(t){if(Array.isArray(t))return o(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return o(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var u=Phaser.Renderer.WebGL.Utils,t={renderWebGL:function(t,e,n,i){if(0!==e.width&&0!==e.height){n.addToRenderList(e);var r=e.frame,s=r.width,a=r.height,o=u.getTintAppendFloatAlpha,l=t.pipelines.set(e.pipeline,e),h=l.setTexture2D(r.glTexture,e);t.pipelines.preBatch(e),l.batchTexture(e,r.glTexture,s,a,e.x,e.y,s/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,s,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,h),t.pipelines.postBatch(e)}},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i))}},f=Phaser.Display.Canvas.CanvasPool,c=Phaser.GameObjects.GameObject,e=function(){s(e,c);var t=h(e);function e(){return y(this,e),t.apply(this,arguments)}return r(e,[{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setTestString",value:function(t){return this.style.setTestString(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,r,s){return this.style.setShadow(t,e,n,i,r,s)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setWordWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.style.setLineSpacing(t)}},{key:"lineSpacing",get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},{key:"setXOffset",value:function(t){return this.style.setXOffset(t)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"measureTextMargins",value:function(t,e){return function(t,e,n){void 0===n&&(n={});var i=f.create(this),r=i.getContext("2d",{willReadFrequently:!0});t.syncFont(i,r);var s=r.measureText(e),a=Math.ceil(s.width*t.baselineX),o=a,l=2*o;if(o=o*t.baselineY|0,i.width=a,i.height=l,r.fillStyle="#f00",r.fillRect(0,0,a,l),r.font=t._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(t.testString,0,o),(n.left=0)===a||0==l||!r.getImageData(0,0,a,l))return f.remove(i),n;for(var h=r.getImageData(0,0,a,l).data,u=!1,c=0;c<a;c++){for(var d=0;d<l;d++){if(255!==h[4*(d*a+c)]){n.left=c,u=!0;break}}if(u)break}return f.remove(i),n}(this.style,t,e)}}]),e}(),d=Phaser.GameObjects.Components;Phaser.Class.mixin(e,[d.Alpha,d.BlendMode,d.ComputedSize,d.Crop,d.Depth,d.Flip,d.GetBounds,d.Mask,d.Origin,d.Pipeline,d.PostPipeline,d.ScrollFactor,d.Tint,d.Transform,d.Visible,t]);function p(t,e,n){if(null==t)return t;switch(l(t)){case"string":return t;case"number":return"#".concat(w(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,n);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t;default:return t}}function k(t){var e=m.create(this),n=e.getContext("2d",{willReadFrequently:!0});t.syncFont(e,n);var i=n.measureText(t.testString);if("actualBoundingBoxAscent"in i){var r=i.actualBoundingBoxAscent,s=i.actualBoundingBoxDescent,a={ascent:r,descent:s,fontSize:r+s};return m.remove(e),a}var o=Math.ceil(i.width*t.baselineX),l=o,h=2*l;if(l=l*t.baselineY|0,e.width=o,e.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,l),a={ascent:0,descent:0,fontSize:0},!n.getImageData(0,0,o,h))return a.ascent=l,a.descent=l+6,a.fontSize=a.ascent+a.descent,m.remove(e),a;var u,c,d=n.getImageData(0,0,o,h).data,f=d.length,g=4*o,p=0,y=!1;for(u=0;u<l;u++){for(c=0;c<g;c+=4)if(255!==d[p+c]){y=!0;break}if(y)break;p+=g}for(a.ascent=l-u,p=f-g,y=!1,u=h;l<u;u--){for(c=0;c<g;c+=4)if(255!==d[p+c]){y=!0;break}if(y)break;p-=g}return a.descent=u-l,a.fontSize=a.ascent+a.descent,m.remove(e),a}function b(t,e,n,i,r,s,a,o,l,h,u,c,d){var f,g,p,y,v,k,x,w,S,m,E,T,O,R,b;if(f=e,k=d,m=new z(g=n,p=i,y=r,v=s,a),E=m.minWidth,T=m.minHeight,O=E<=y?1:y/E,R=T<=v?1:v/T,b=m.cornerRadius,f.save(),f.beginPath(),f.translate(g,p),x=b.tl,U(x)?(w=x.x*O,S=x.y*R,X(x)?Y(f,w,S,w,S,180,270,!1,k):Y(f,0,0,w,S,90,0,!0,k)):f.lineTo(0,0),x=b.tr,U(x)?(w=x.x*O,S=x.y*R,X(x)?Y(f,y-w,S,w,S,270,360,!1,k):Y(f,y,0,w,S,180,90,!0,k)):f.lineTo(y,0),x=b.br,U(x)?(w=x.x*O,S=x.y*R,X(x)?Y(f,y-w,v-S,w,S,0,90,!1,k):Y(f,y,v,w,S,270,180,!0,k)):f.lineTo(y,v),x=b.bl,U(x)?(w=x.x*O,S=x.y*R,X(x)?Y(f,w,v-S,w,S,90,180,!1,k):Y(f,0,v,w,S,360,270,!0,k)):f.lineTo(0,v),f.closePath(),f.restore(),null!=o){var P;if(null!=u)(P=c?e.createLinearGradient(0,0,r,0):e.createLinearGradient(0,0,0,s)).addColorStop(0,o),P.addColorStop(1,u),o=P;e.fillStyle=o,e.fill()}null!=l&&0<h&&(e.strokeStyle=l,e.lineWidth=h,e.stroke())}function g(t){if("object"!==l(t)||null===t)return t;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e];return t}function C(t,e){var n=Array.isArray(t);if(void 0===e?e=n?[]:{}:g(e),n){e.length=t.length;for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}else for(var s in t)e[s]=t[s];return e}function x(){}function M(t,e,n,i,r,s){i<=0&&(n=gt);var a=[];if(!t||!t.length)return a;for(var o,l,h,u=n===gt,c=n===pt,d=t.split(vt),f=0,g=d.length;f<g;f++)if(o=d[f],h=f===g-1?ct:dt,u){var p=e(o);a.push(s.getLine(o,p,h))}else{var y,v,k,x,w;if(l=0===f?i-r:i,o.length<=100)if((p=e(o))<=l){a.push(s.getLine(o,p,h));continue}c?(v=""===(y=o.split(" "))[y.length-1])&&--y.length:y=o;for(var S,m="",E=0,T=c?e(" "):void 0,O=0,R=y.length;O<R;O++)if(x=e(k=y[O]),w=O===R-1,!c||w&&!v||(k+=" ",x+=T),c&&i<x){""!==m?a.push(s.getLine(m,E,ft)):0===O&&0<r&&a.push(s.getLine("",0,ft)),a.push.apply(a,P(M(k,e,yt,i,0,s)));var b=a.pop();m=b.text,E=b.width,s.freeLine(b)," "===m&&(m="",E=0)}else l<(S=E+x)?(a.push(s.getLine(m,E,ft)),m=k,E=x,l=i):(m+=k,E=S),w&&a.push(s.getLine(m,E,h))}return a}var w=Phaser.Utils.String.Pad,S={backgroundColor:["backgroundColor",null,p],backgroundColor2:["backgroundColor2",null,p],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,p],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",p],stroke:["stroke","#fff",p],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",p],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",p],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]},m=Phaser.Display.Canvas.CanvasPool,E=0,T=1,O=2,R=0,_=1,L=2,A=/(?:\r\n|\r|\n)/,F=Phaser.Utils.Objects.GetAdvancedValue,W=Phaser.Utils.Objects.GetValue,I=function(){function i(t,e,n){y(this,i),this.parent=t,void 0===n&&(n=S),this.propertyMap=n,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}return r(i,[{key:"isWrapFitMode",get:function(){return 0<this.fixedWidth&&this.wrapMode!==R&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var r=i.mode;"string"==typeof r&&(i.mode=N[r])}else i.hasOwnProperty("width")&&(i.mode=1)}t&&t.rtl&&n&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px");var s=this.propertyMap;for(var a in s){var o=s[a],l=o[0],h=n?o[1]:this[a],u=o[2];if("wrapCallback"===a||"wrapCallbackScope"===a)this[a]=W(t,l,h);else{var c=F(t,l,h);u&&(c=u(c)),this[a]=c}}var d=W(t,"font",null);this._font=null===d?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:d;var f=W(t,"fill",null);null!==f&&(this.color=p(f));var g=W(t,"metrics",!1);return g?this.metrics={ascent:W(g,"ascent",0),descent:W(g,"descent",0),fontSize:W(g,"fontSize",0)}:!e&&this.metrics||(this.metrics=k(this)),e?this.parent.updateText():this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=k(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=W(t,"fontFamily","Courier"),this.fontSize=W(t,"fontSize","16px"),this.fontStyle=W(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.update(!1)}},{key:"setXOffset",value:function(t){return this.xOffset=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=p(t,this.parent.canvas,this.parent.context),this.backgroundColor2=p(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=p(t,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=p(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=p(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=p(t,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,r,s){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===s&&(s=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=p(n,this.parent.canvas,this.parent.context),this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=s,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return void 0===t&&(t="#000"),this.shadowColor=p(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=p(t,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return void 0===t&&(t="#000"),this.underlineColor=p(t,this.parent.canvas,this.parent.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}},{key:"setWrapMode",value:function(t){return"string"==typeof t&&(t=N[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}},{key:"setVAlign",value:function(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}},{key:"setMaxLines",value:function(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=W(e,"fontFamily",this.fontFamily),this.fontSize=W(e,"fontSize",this.fontSize),this.fontStyle=W(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}},{key:"toJSON",value:function(){var t={},e=this.propertyMap;for(var n in e)t[n]=this[n];return t.metrics=this.getTextMetrics(),t}},{key:"destroy",value:function(){this.parent=void 0}}]),i}(),N={none:R,word:_,char:L,character:L},B=Phaser.Utils.Objects.GetValue,z=function(){function s(t,e,n,i,r){y(this,s),void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,n,i,r)}return r(s,[{key:"setTo",value:function(t,e,n,i,r){return this.setPosition(t,e),this.setRadius(r),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){return void 0===t&&(t=0),this.radius=t,this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)},set:function(t){var e,n;n="number"==typeof t?e=t:(e=B(t,"x",0),B(t,"y",0));var i=this.cornerRadius;i.tl=j(B(t,"tl",void 0),e,n),i.tr=j(B(t,"tr",void 0),e,n),i.bl=j(B(t,"bl",void 0),e,n),i.br=j(B(t,"br",void 0),e,n)}},{key:"radiusTL",get:function(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)},set:function(t){H(this.cornerRadius.tl,t)}},{key:"radiusTR",get:function(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)},set:function(t){H(this.cornerRadius.tr,t)}},{key:"radiusBL",get:function(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)},set:function(t){H(this.cornerRadius.bl,t)}},{key:"radiusBR",get:function(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)},set:function(t){H(this.cornerRadius.br,t)}}]),s}(),j=function(t,e,n){return void 0===t?t={x:e,y:n}:"number"==typeof t&&(t={x:t,y:t}),G(t),t},H=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=B(e,"x",0),t.y=B(e,"y",0)),G(t)},G=function(t){t.convex=0<=t.x||0<=t.y,t.x=Math.abs(t.x),t.y=Math.abs(t.y)},D=Phaser.Math.DegToRad,X=function(t){return!t.hasOwnProperty("convex")||t.convex},U=function(t){return 0<t.x&&0<t.y},Y=function(t,e,n,i,r,s,a,o,l){if(o&&s<a?a-=360:!o&&a<s&&(a+=360),s=D(s),a=D(a),null==l)t.ellipse(e,n,i,r,0,s,a,o);else for(var h,u,c,d=(a-s)/(l+=1),f=0;f<=l;f++)c=s+d*f,h=e+i*Math.cos(c),u=n+r*Math.sin(c),t.lineTo(h,u)},K={draw:function(t,e,n,i){var r=this.penManager;this.hitAreaManager.clear();var s=this.context;s.save();var a=this.defaultStyle;this.clear(),function(t,e,n,i,r,s,a,o){if(null!=e||null!=n){var l=t.canvas.width,h=t.canvas.height;null==n&&(i=0);var u=i/2;l=Math.max(1,l-i),h=Math.max(1,h-i),b(t.canvas,t.context,u,u,l,h,r,e,n,i,s,a,o)}}(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var o,l,h,u,c,d,f=a.halign,g=a.valign,p=a.lineHeight,y=r.lines,v=y.length,k=a.maxLines;u=(h=0<k&&k<v?(l=k,"center"===g?Math.floor((v-l)/2):"bottom"===g?v-l:0):(l=v,0))+l;var x=this.rtl,w=x?this.parent.width:void 0;d="center"===g?Math.max((i-l*p)/2,0):"bottom"===g?Math.max(i-l*p-2,0):0,d+=e;for(var S=h;S<u;S++)if(0!==(o=r.getLineWidth(S))){for(var m=y[S],E=m.length,T=f,O=0;O<E;O++){var R=m[O].prop.align;if(void 0!==R){T=R;break}}c="center"===T?(n-o)/2:"right"===T?x?0:n-o:x?n-o:0,c+=t;for(O=0;O<E;O++)this.drawPen(m[O],c,d,w)}s.restore()},drawPen:function(t,e,n,i){e+=t.x,n+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var r=this.canvas,s=this.context;s.save();var a=this.parser.propToContextStyle(this.defaultStyle,t.prop);if(a.buildFont(),a.syncFont(r,s),a.syncStyle(r,s),0<a.underlineThickness&&0<t.width&&this.drawUnderline(e,n,t.width,a),t.isTextPen&&this.drawText(e,n,t.text,a),t.isImagePen&&this.drawImage(e,n,t.prop.img,a),s.restore(),t.hasAreaMarker&&0<t.width){var o,l=t.prop.area;if(l)o={key:l};else{var h=t.prop.url;o={key:"url:".concat(h),url:h}}this.hitAreaManager.add(e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight,o)}},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawUnderline:function(t,e,n,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context,s=r.lineCap;r.lineCap="butt",r.strokeStyle=i.underlineColor,r.lineWidth=i.underlineThickness,r.beginPath(),r.moveTo(t,e),r.lineTo(t+n,e),r.stroke(),r.lineCap=s},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;i.stroke&&"none"!==i.stroke&&0<i.strokeThickness&&(i.syncShadow(r,i.shadowStroke),r.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(n,t,e))},drawImage:function(t,e,n){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,this.autoRound)}},V=Phaser.Utils.Objects.GetValue,J=E,q=T,Z=function(){function e(t){y(this,e),this.prop={},this.resetFromJSON(t)}return r(e,[{key:"resetFromJSON",value:function(t){this.text=V(t,"text",""),this.x=V(t,"x",0),this.y=V(t,"y",0),this.width=V(t,"width",0);var e=V(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=V(t,"newLineMode",0),this.startIndex=V(t,"startIndex",0)}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===q&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==J&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===q&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return""!==this.text}},{key:"isImagePen",get:function(){return!!this.prop.img}},{key:"hasAreaMarker",get:function(){return!!this.prop.area||!!this.prop.url}}]),e}(),$=Phaser.Utils.Objects.GetFastValue,Q=E,tt=O,et=function(){function o(t){y(this,o),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.tagToText=$(t,"tagToText",x),this.tagToTextScope=$(t,"tagToTextScope",void 0)}return r(o,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}},{key:"addTextPen",value:function(t,e,n,i,r,s){var a=this.pensPool.pop();return null==a&&(a=new Z),nt.text=t,nt.x=e,nt.y=n,nt.width=i,nt.prop=r,nt.newLineMode=s,a.resetFromJSON(nt),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,Q),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,i=t?C(t.prop):null;return this.addTextPen("",e,n,0,i,tt),this}},{key:"addPen",value:function(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var n=this.lastLine;null==n&&(n=this.linesPool.pop()||[],this.lines.push(n)),n.push(t),t.newLineMode!==Q&&(n=this.linesPool.pop()||[],this.lines.push(n)),this.maxLinesWidth=void 0}},{key:"clone",value:function(t){null==t&&(t=new o),t.clear();for(var e=0,n=this.lines.length;e<n;e++)for(var i=this.lines[e],r=0,s=i.length;r<s;r++){var a=i[r];t.addPen(a.text,a.x,a.y,a.width,C(a.prop),a.newLineMode)}return t}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){t>=this.lines.length&&(t=this.lines.length-1);var e,n,i=!1;for(e=t;0<=e&&!(i=null!=(n=this.lines[e])&&0<n.length);e--);return i?n[n.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){var e=this.lines[t];if(!e)return 0;var n=e[e.length-1];return null==n?0:n.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)e<(t=this.getLineWidth(n))&&(e=t);return this.maxLinesWidth=e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===n&&(n=!1);for(var r,s,a,o,l,h,u="",c=0,d=this.pens.length;c<d&&((o=(r=this.pens[c]).endIndex)<=t||(r=this.pens[c],s=n?r.wrapText:r.plainText,l=r.prop,t<=(a=r.startIndex)&&o<=e||(s=s.substring(t-a,e-a)),this.tagToTextScope?u+=this.tagToText.call(this.tagToTextScope,s,l,h):u+=this.tagToText(s,l,h),h=l,!(e<=o)));c++);return u}},{key:"length",get:function(){return this.lines.length},set:function(){this.clear()}}]),o}(),nt={},it=function(){function t(){y(this,t),this.items=[]}return r(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),rt=Phaser.Geom.Rectangle,st=new it,at=function(){function t(){y(this,t),this.hitAreas=[]}return r(t,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){for(var t=0,e=this.hitAreas.length;t<e;t++)g(this.hitAreas[t].data);return st.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,r){var s=st.pop();return null===s?s=new rt(t,e,n,i):s.setTo(t,e,n,i),s.data=r,this.hitAreas.push(s),this}},{key:"getFirst",value:function(t,e){for(var n=0,i=this.hitAreas.length;n<i;n++){var r=this.hitAreas[n];if(r.contains(t,e))return r}return null}},{key:"getByKey",value:function(t){for(var e=0,n=this.hitAreas.length;e<n;e++){var i=this.hitAreas[e];if(i.data.key===t)return i}return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i=0,r=this.hitAreas.length;i<r;i++){var s=this.hitAreas[i];t.lineStyle(1,e).strokeRect(s.x,s.y,s.width,s.height)}return n&&t.restore(),this}}]),t}(),ot=function(t,e,n,i){var r=this.hitAreaManager.getFirst(e,n);if(null!==r){var s=r.data.key;ut.call(this,"areadown",s,t,e,n,i),r.data.isDown=!0}},lt=function(t,e,n,i){var r=this.hitAreaManager.getFirst(e,n);if(null!==r){var s=r.data,a=s.key;if(ut.call(this,"areaup",a,t,e,n,i),s.isDown){ut.call(this,"areaclick",a,t,e,n,i);var o=s.url;o&&window.open(o,"_blank")}s.isDown=!1}},ht=function(t,e,n,i){if(null!==e){var r=this.hitAreaManager.getFirst(e,n),s=r?r.data.key:null;if(this.lastHitAreaKey!==s){if(null!==this.lastHitAreaKey){ut.call(this,"areaout",this.lastHitAreaKey,t,e,n,i);var a=this.hitAreaManager.getByKey(this.lastHitAreaKey);this.urlTagCursorStyle&&a.data.url&&(this.scene.input.manager.canvas.style.cursor=""),a.isDown=!1}null!==s&&(ut.call(this,"areaover",s,t,e,n,i),this.urlTagCursorStyle&&r.data.url&&(this.scene.input.manager.canvas.style.cursor=this.urlTagCursorStyle)),this.lastHitAreaKey=s}}else null!==this.lastHitAreaKey&&(ut.call(this,"areaout",this.lastHitAreaKey,t,e,n,i),this.hitAreaManager.getByKey(this.lastHitAreaKey).isDown=!1,this.lastHitAreaKey=null)},ut=function(t,e,n,i,r,s){this.parent.emit("".concat(t,"-").concat(e),n,i,r,s),this.parent.emit(t,e,n,i,r,s)},ct=E,dt=T,ft=O,gt=R,pt=_,yt=L,vt=A,kt=Phaser.Utils.Objects.GetValue,xt=R,wt=E,St=function(){function n(t){y(this,n),this.parent=t.parent,this.scene=this.parent.scene,this.context=kt(t,"context",null),this.canvas=this.context.canvas,this.parser=kt(t,"parser",null),this.defaultStyle=kt(t,"style",null),this.autoRound=!0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.wrapTextLinesPool=t.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new at,this.lastHitAreaKey=null,this.urlTagCursorStyle=null;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}return r(n,[{key:"destroy",value:function(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0}},{key:"updatePenManager",value:function(t,e,n,i,r){if(void 0===r&&(r=this.penManager),r.clear(),""===t)return r;var s=this.parent.style;if(s.isWrapFitMode){var a=this.parent.padding;n=s.fixedWidth-a.left-a.right}function o(t){return g.measureText(t).width}for(var l,h,u,c,d,f=this.canvas,g=this.context,p=0,y=0,v=s.wrapCallback,k=s.wrapCallbackScope,x=!0,w=this.parser.splitText(t),S=this.wrapTextLinesPool,m=0,E=w.length;m<E;m++)if(l=(c=this.parser.tagTextToProp(w[m],h)).plainText,(h=c.prop).img){var T=this.imageManager.getOuterWidth(h.img);0<n&&e!==xt&&n<p+T&&(r.addNewLinePen(),y+=i,p=0),r.addImagePen(p,y,T,C(h)),p+=T}else if(""!==l){if(g.save(),(u=this.parser.propToContextStyle(this.defaultStyle,h)).buildFont(),u.syncFont(f,g),u.syncStyle(f,g),v){"string"==typeof(d=v.call(k,l,o,n,p))&&(d=d.split("\n"));for(var O=0,R=d.length;O<R;O++)"string"==typeof(b=d[O])?d[O]=S.getLine(b,o(b),O<R-1?2:0):x=!1}else d=M(l,o,e,n,p,S);var b;for(O=0,R=d.length;O<R;O++)b=d[O],r.addTextPen(b.text,p,y,b.width,C(h),b.newLineMode),b.newLineMode!==wt?(p=0,y+=i):p+=b.width;x&&S.freeLines(d),d=null,g.restore()}for(m=0,E=this.lines.length;m<E;m++){var P=this.lines[m],_=P[P.length-1];_&&(_.width+=this.parser.getStrokeThinkness(this.defaultStyle,_.prop))}return r}},{key:"startXOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.xOffset}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return 0<e&&e<t&&(t=e),t}},{key:"linesWidth",get:function(){return Math.ceil(this.penManager.getMaxLineWidth())}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return 0<t&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"rtl",get:function(){return this.parent.style.rtl}},{key:"newPenManager",value:function(){return new et({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){var i;if(null==t)i=this.penManager.plainText;else{var r=this.parser.splitText(t,1);i="";for(var s=0,a=r.length;s<a;s++)i+=r[s]}return null==e&&null==n||(null==e&&(e=0),null==n&&(n=i.length),i=i.substring(e,n)),i}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){if(null==t)return this.penManager.getSliceTagText(e,n,i);var r=this.tmpPenManager,s=this.defaultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,r),r.getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}},{key:"getTextWidth",value:function(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}},{key:"getLastPen",value:function(t){return void 0===t&&(t=this.penManager),t.lastPen}}]),n}(),mt={setInteractive:function(){this.parent.on("pointerdown",ot,this).on("pointerup",lt,this).on("pointermove",ht,this).on("pointerover",ht,this).on("pointerout",function(t,e){ht.call(this,t,null,null,e)},this)}};Object.assign(St.prototype,K,mt);function Et(t,e){Ot(t)?t=(e=t).key:void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var n=e.key,i=e.frame,r=e.width,s=e.height;if(void 0===r||void 0===s){var a=this.textureManager.getFrame(n,i),o=a?a.cutWidth:0,l=a?a.cutHeight:0;void 0===r&&void 0===s?(r=o,s=l):void 0===r?r=o*(s/l):void 0===s&&(s=l*(r/o))}this.images[t]={key:n,frame:i,width:r,height:s,y:Rt(e,"y",0),left:Rt(e,"left",0),right:Rt(e,"right",0),originX:Rt(e,"originX",0),originY:Rt(e,"originY",0)}}var Tt=function(){s(e,it);var t=h(e);function e(){return y(this,e),t.apply(this,arguments)}return r(e,[{key:"freeLine",value:function(t){if(t)return this.push(t),this}},{key:"freeLines",value:function(t){if(t)return this.pushMultiple(t),this}},{key:"getLine",value:function(t,e,n){var i=this.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=n,i}}]),e}(),Ot=Phaser.Utils.Objects.IsPlainObject,Rt=Phaser.Utils.Objects.GetValue,bt=function(){function e(t){y(this,e),this.textureManager=t.sys.textures,this.images={}}return r(e,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0}},{key:"add",value:function(t,e){if("string"==typeof t)Et.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(r=t).length;n<i;n++)Et.call(this,r[n]);else{var r=t;for(var t in r)Et.call(this,t,r[t])}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){var e=this.get(t);return e?e.width+e.left+e.right:0}},{key:"getFrame",value:function(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}},{key:"hasTexture",value:function(t){return!!this.getFrame(t)}}]),e}(),Pt={draw:function(t,e,n,i,r){var s=this.get(t),a=this.textureManager.getFrame(s.key,s.frame),o=s.width,l=s.height;n+=s.left-s.originX*o,i+=s.y-s.originY*l,r&&(n=Math.round(n),i=Math.round(i)),e.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,n,i,o,l)}};Object.assign(bt.prototype,Pt);function _t(t){return t.replace($t,"\\$&").replace(Qt,"\\x2d")}function Ct(t,e,n,i){return void 0===i?"".concat(t).concat(n).concat(e):"".concat(t).concat(n,"=(").concat(i,")").concat(e)}function Mt(t,e,n){return"".concat(t,"/").concat(n).concat(e)}function Lt(t,e){if(void 0===e){var n=t;t=n[0],e=n[1]}if(Ft!==t||Wt!==e){Wt=e,t=_t(Ft=t),e=_t(e);var i=Ct(t,e,"esc"),r=Mt(t,e,"esc"),s=Ct(t,e,"raw"),a=Mt(t,e,"raw"),o=Ct(t,e,"b"),l=Mt(t,e,"b"),h=Ct(t,e,"i"),u=Mt(t,e,"i"),c=Ct(t,e,"weight",ee),d=Mt(t,e,"weight"),f=Ct(t,e,"size",ee),g=Mt(t,e,"size"),p=Ct(t,e,"color",ne),y=Mt(t,e,"color"),v=Ct(t,e,"u"),k=Ct(t,e,"u",ne),x=Mt(t,e,"u"),w=Ct(t,e,"shadow"),S=Mt(t,e,"shadow"),m="stroke",E=Ct(t,e,m),T=Ct(t,e,m,ne),O=Mt(t,e,m),R=Ct(t,e,"y",ee),b=Mt(t,e,"y"),P=Ct(t,e,"img",ie),_=Mt(t,e,"img"),C=Ct(t,e,"area",ie),M=Mt(t,e,"area"),L=Ct(t,e,"url",ie),A=Mt(t,e,"url"),F=Ct(t,e,"align",ie),W=Mt(t,e,"align");return te.RE_ESC_OPEN=new RegExp(i,"i"),te.RE_ESC_CLOSE=new RegExp(r,"i"),te.RE_RAW_OPEN=new RegExp(s,"i"),te.RE_RAW_CLOSE=new RegExp(a,"i"),te.RE_BLOD_OPEN=new RegExp(o,"i"),te.RE_BLOD_CLOSE=new RegExp(l,"i"),te.RE_ITALICS_OPEN=new RegExp(h,"i"),te.RE_ITALICS_CLOSE=new RegExp(u,"i"),te.RE_WEIGHT_OPEN=new RegExp(c,"i"),te.RE_WEIGHT_CLOSE=new RegExp(d,"i"),te.RE_SIZE_OPEN=new RegExp(f,"i"),te.RE_SIZE_CLOSE=new RegExp(g,"i"),te.RE_COLOR_OPEN=new RegExp(p,"i"),te.RE_COLOR_CLOSE=new RegExp(y,"i"),te.RE_UNDERLINE_OPEN=new RegExp(v,"i"),te.RE_UNDERLINE_OPENC=new RegExp(k,"i"),te.RE_UNDERLINE_CLOSE=new RegExp(x,"i"),te.RE_SHADOW_OPEN=new RegExp(w,"i"),te.RE_SHADOW_CLOSE=new RegExp(S,"i"),te.RE_STROKE_OPEN=new RegExp(E,"i"),te.RE_STROKE_OPENC=new RegExp(T,"i"),te.RE_STROKE_CLOSE=new RegExp(O,"i"),te.RE_OFFSETY_OPEN=new RegExp(R,"i"),te.RE_OFFSETY_CLOSE=new RegExp(b,"i"),te.RE_IMAGE_OPEN=new RegExp(P,"i"),te.RE_IMAGE_CLOSE=new RegExp(_,"i"),te.RE_AREA_OPEN=new RegExp(C,"i"),te.RE_AREA_CLOSE=new RegExp(M,"i"),te.RE_URL_OPEN=new RegExp(L,"i"),te.RE_URL_CLOSE=new RegExp(A,"i"),te.RE_ALIGN_OPEN=new RegExp(F,"i"),te.RE_ALIGN_CLOSE=new RegExp(W,"i"),te.RE_SPLITTEXT=new RegExp([s,a,i,r,o,l,h,u,c,d,f,g,p,y,v,k,x,w,S,E,T,O,R,b,P,_,C,M,L,A,F,W].join("|"),"ig"),1}}function At(t,e){return void 0!==t&&Lt(t,e),Object.assign({},te)}var Ft,Wt,It=Phaser.Utils.Objects.IsPlainObject,Nt=Phaser.DOM.AddToDOM,Bt=Phaser.Display.Canvas.CanvasPool,zt=Phaser.GameObjects.GameObject,jt=Phaser.Utils.Objects.GetValue,Ht=Phaser.DOM.RemoveFromDOM,Gt=A,Dt=null,Xt=null,Ut=null,Yt=function(){s(p,e);var g=h(p);function p(t,e,n,i,r,s,a){var o;if(y(this,p),It(e)){var l=e;e=jt(l,"x",0),n=jt(l,"y",0),i=jt(l,"text",""),r=jt(l,"style")}if(void 0===e&&(e=0),void 0===n&&(n=0),(o=g.call(this,t,s)).renderer=t.sys.game.renderer,o.setPosition(e,n),o.setOrigin(0,0),o.initPipeline(),o.canvas=Bt.create(v(o)),o.context=o.canvas.getContext("2d",{willReadFrequently:!0}),o._imageManager=void 0,r){if(r.hasOwnProperty("align")){var h=r.align;delete r.align,r.halign=h}r.hasOwnProperty("stroke")&&!r.hasOwnProperty("strokeThickness")&&(r.strokeThickness=1)}o.style=new I(v(o),r);var u,c,d,f=jt(r,"images",void 0);return f&&o.addImage(f),o.autoRound=!0,o._text=void 0,o.padding={left:0,right:0,top:0,bottom:0},o.width=1,o.height=1,o.dirty=!1,0===o.style.resolution&&(o.style.resolution=1),o._crop=o.resetCropObject(),o.texture=t.sys.textures.addCanvas(null,o.canvas,!0),o.frame=o.texture.get(),o.frame.source.resolution=o.style.resolution,o.renderer&&o.renderer.gl&&(o.renderer.deleteTexture(o.frame.source.glTexture),o.frame.source.glTexture=null),d=jt(r,"sharedPool",!0)?(Dt||(Dt={},Xt=new it,Ut=new Tt,o.scene.game.events.once("destroy",function(){Ut=Xt=Dt=null})),Dt.hasOwnProperty(s)||(Dt[s]=new it),u=Dt[s],c=Xt,Ut):(u=new it,c=new it,new Tt),o.canvasText=new St({parent:v(o),context:o.context,parser:a,style:o.style,pensPool:u,linesPool:c,wrapTextLinesPool:d}),o.parser=a,o.initRTL(),r&&r.padding&&o.setPadding(r.padding),o.setText(i),o.setUrlTagCursorStyle(jt(r,"urlTagCursorStyle","pointer")),jt(r,"interactive",!1)&&o.setInteractive(),o}return r(p,[{key:"preDestroy",value:function(){this.style.rtl&&Ht(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Bt.remove(this.canvas),this.texture.destroy()}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",Nt(this.canvas,this.scene.sys.canvas),this.originX=1)}},{key:"setText",value:function(t){return(t=null==t?"":Array.isArray(t)?t.join("\n"):t.toString())===this._text||(this._text=t,this.updateText()),this}},{key:"appendText",value:function(t){return null==t||(Array.isArray(t)&&(t=t.join("\n")),this.setText(this.text+t.toString())),this}},{key:"setPadding",value:function(t,e,n,i){if("object"===l(t)){var r=t,s=jt(r,"x",null);n=null!==s?t=s:(t=jt(r,"left",0),jt(r,"right",t));var a=jt(r,"y",null);i=null!==a?e=a:(e=jt(r,"top",0),jt(r,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=t),void 0===i&&(i=e);return this.padding.left=t,this.padding.top=e,this.padding.right=n,this.padding.bottom=i,this.updateText(!1)}},{key:"updateText",value:function(t){void 0===t&&(t=!0);var e=this.canvasText,n=this.style;t&&e.updatePenManager(this._text,n.wrapMode,n.wrapWidth,n.lineHeight);var i,r,s=this.padding,a=Math.ceil(e.linesWidth);0===n.fixedWidth?(this.width=a+s.left+s.right,i=a):(this.width=n.fixedWidth,(i=this.width-s.left-s.right)<a&&(i=a)),0===n.fixedHeight?(this.height=e.linesHeight+s.top+s.bottom,r=e.linesHeight):(this.height=n.fixedHeight,(r=this.height-s.top-s.bottom)<e.linesHeight&&(r=e.linesHeight));var o=this.width,l=this.height;this.updateDisplayOrigin();var h=n.resolution;o*=h,l*=h,o=Math.max(Math.ceil(o),1),l=Math.max(Math.ceil(l),1);var u=this.canvas,c=this.context;u.width!==o||u.height!==l?(u.width=o,u.height=l,this.frame.setSize(o,l)):c.clearRect(0,0,o,l),c.save(),c.scale(h,h);var d=this.style.rtl?s.right:s.left,f=s.top;e.draw(d,f,i,r),c.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(u,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var g=this.input;return g&&!g.customHitArea&&(g.hitArea.width=this.width,g.hitArea.height=this.height),this}},{key:"toJSON",value:function(){var t=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){var i=!!this.input;return zt.prototype.setInteractive.call(this,t,e,n),i||this.canvasText.setInteractive(),this}},{key:"setUrlTagCursorStyle",value:function(t){return this.urlTagCursorStyle=t,this}},{key:"urlTagCursorStyle",get:function(){return this.canvasText.urlTagCursorStyle},set:function(t){this.canvasText.urlTagCursorStyle=t}},{key:"getWrappedText",value:function(t,e,n){return(t=this.canvasText.getText(t,e,n,!0)).split(Gt)}},{key:"getPlainText",value:function(t,e,n){return this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n,i){return void 0===i&&(i=!1),this.canvasText.getText(t,e,n,i)}},{key:"getSubString",value:function(t,e,n){return this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new bt(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}},{key:"generateTexture",value:function(t,e,n,i,r){var s=this.canvas;return void 0===i?i=s.width:i*=this.resolution,void 0===r?r=s.height:r*=this.resolution,function(t,e,n,i,r,s,a){var o,l=t.sys.textures,h=t.renderer;void 0===i&&(i=0),void 0===r&&(r=0),void 0===s&&(s=e.width),void 0===a&&(a=e.height);var u=(o=l.exists(n)?l.get(n):l.createCanvas(n,s,a)).getSourceImage();u.width!==s&&(u.width=s),u.height!==a&&(u.height=a);var c=u.getContext("2d",{willReadFrequently:!0});c.clearRect(0,0,s,a),c.drawImage(e,i,r,s,a),h.gl&&o&&h.canvasToTexture(u,o.source[0].glTexture,!0,0)}(this.scene,s,t,e,n,i,r),this}}]),p}(),Kt={plainText:null,prevProp:null},Vt=function(t,e,n,i){return!0===e?t[n]=i:t.hasOwnProperty(n)&&delete t[n],t},Jt=function(t){var e=t.b,n=t.weight,i=t.i;return e||n||i?i?e?"bold italic":n?"".concat(n," italic"):"italic":e?"bold":n.toString():""},qt=new I,Zt={},$t=/[|\\{}()[\]^$+*?.]/g,Qt=/-/g,te={},ee="[-.0-9]+",ne="[a-z]+|#[0-9abcdef]+",ie="[^\\]]+",re=Phaser.Utils.Objects.GetValue,se=function(){function n(t){y(this,n);var e=re(t,"delimiters","[]");this.tagRegex=At(e)}return r(n,[{key:"getStrokeThinkness",value:function(t,e){return e.hasOwnProperty("stroke")?t.strokeThickness:0}},{key:"setDelimiters",value:function(t,e){return Lt(t,e)&&(this.tagRegex=At()),this}}]),n}(),ae={splitText:function(t,e){for(var n=this.tagRegex,i=[],r=0,s=!1,a=!1;;){var o=n.RE_SPLITTEXT.exec(t);if(!o)break;var l=o[0];if(a){if(!n.RE_ESC_CLOSE.test(l))continue;a=!1}else if(s){if(!n.RE_RAW_CLOSE.test(l))continue;s=!1}else n.RE_ESC_OPEN.test(l)?a=!0:n.RE_RAW_OPEN.test(l)&&(s=!0);var h=n.RE_SPLITTEXT.lastIndex,u=h-l.length;if(r<u){var c=t.substring(r,u);i.push(c)}void 0===e&&i.push(l),r=h}var d=t.length;return r<d&&i.push(t.substring(r,d)),i},tagTextToProp:function(t,e){var n=this.tagRegex;null==e&&(e={});var i="";if(e.img&&Vt(e,!1,"img"),e.esc)n.RE_ESC_CLOSE.test(t)?Vt(e,!1,"esc"):i=t;else if(e.raw)n.RE_RAW_CLOSE.test(t)?Vt(e,!1,"raw"):i=t;else if(n.RE_ESC_OPEN.test(t))Vt(e,!0,"esc",!0);else if(n.RE_ESC_CLOSE.test(t))Vt(e,!1,"esc");else if(n.RE_RAW_OPEN.test(t))Vt(e,!0,"raw",!0);else if(n.RE_RAW_CLOSE.test(t))Vt(e,!1,"raw");else if(n.RE_BLOD_OPEN.test(t))Vt(e,!0,"b",!0);else if(n.RE_BLOD_CLOSE.test(t))Vt(e,!1,"b");else if(n.RE_ITALICS_OPEN.test(t))Vt(e,!0,"i",!0);else if(n.RE_ITALICS_CLOSE.test(t))Vt(e,!1,"i");else if(n.RE_WEIGHT_OPEN.test(t)){var r=t.match(n.RE_WEIGHT_OPEN);Vt(e,!0,"weight",r[1])}else if(n.RE_WEIGHT_CLOSE.test(t))Vt(e,!1,"weight");else if(n.RE_SIZE_OPEN.test(t)){r=t.match(n.RE_SIZE_OPEN);Vt(e,!0,"size","".concat(r[1],"px"))}else if(n.RE_SIZE_CLOSE.test(t))Vt(e,!1,"size");else if(n.RE_COLOR_OPEN.test(t)){r=t.match(n.RE_COLOR_OPEN);Vt(e,!0,"color",r[1])}else if(n.RE_COLOR_CLOSE.test(t))Vt(e,!1,"color");else if(n.RE_UNDERLINE_OPEN.test(t))Vt(e,!0,"u",!0);else if(n.RE_UNDERLINE_OPENC.test(t)){r=t.match(n.RE_UNDERLINE_OPENC);Vt(e,!0,"u",r[1])}else if(n.RE_UNDERLINE_CLOSE.test(t))Vt(e,!1,"u");else if(n.RE_SHADOW_OPEN.test(t))Vt(e,!0,"shadow",!0);else if(n.RE_SHADOW_CLOSE.test(t))Vt(e,!1,"shadow");else if(n.RE_STROKE_OPEN.test(t))Vt(e,!0,"stroke",!0);else if(n.RE_STROKE_OPENC.test(t)){r=t.match(n.RE_STROKE_OPENC);Vt(e,!0,"stroke",r[1])}else if(n.RE_STROKE_CLOSE.test(t))Vt(e,!1,"stroke");else if(n.RE_OFFSETY_OPEN.test(t)){r=t.match(n.RE_OFFSETY_OPEN);Vt(e,!0,"y",parseFloat(r[1]))}else if(n.RE_OFFSETY_CLOSE.test(t))Vt(e,!1,"y");else if(n.RE_IMAGE_OPEN.test(t)){r=t.match(n.RE_IMAGE_OPEN);Vt(e,!0,"img",r[1])}else if(n.RE_IMAGE_CLOSE.test(t))Vt(e,!1,"img");else if(n.RE_AREA_OPEN.test(t)){r=t.match(n.RE_AREA_OPEN);Vt(e,!0,"area",r[1])}else if(n.RE_AREA_CLOSE.test(t))Vt(e,!1,"area");else if(n.RE_URL_OPEN.test(t)){r=t.match(n.RE_URL_OPEN);Vt(e,!0,"url",r[1])}else if(n.RE_URL_CLOSE.test(t))Vt(e,!1,"url");else if(n.RE_ALIGN_OPEN.test(t)){r=t.match(n.RE_ALIGN_OPEN);Vt(e,!0,"align",r[1])}else n.RE_ALIGN_CLOSE.test(t)?Vt(e,!1,"align"):i=t;var s=Kt;return s.plainText=i,s.prop=e,s},propToContextStyle:function(t,e){var n=qt;if(e.hasOwnProperty("img"))n.image=e.img;else{if(n.image=null,e.hasOwnProperty("family")?n.fontFamily=e.family:n.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var i=e.size;"number"==typeof i&&(i="".concat(i,"px")),n.fontSize=i}else n.fontSize=t.fontSize;n.fontStyle=Jt(e),e.hasOwnProperty("color")?n.color=e.color:n.color=t.color,e.hasOwnProperty("stroke")?(!0===e.stroke?n.stroke=t.stroke:n.stroke=e.stroke,n.strokeThickness=t.strokeThickness):(n.stroke=t.stroke,n.strokeThickness=0)}return e.hasOwnProperty("shadow")?(!0===e.shadow?n.shadowColor=t.shadowColor:n.shadowColor=e.shadow,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0):(n.shadowColor="#000",n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.shadowStroke=!1,n.shadowFill=!1),e.hasOwnProperty("u")?(!0===e.u?n.underlineColor=t.underlineColor:n.underlineColor=e.u,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset):(n.underlineColor="#000",n.underlineThickness=0,n.underlineOffset=0),n},propToTagText:function(t,e,n){null==n&&(n=Zt);var i=[];for(var r in n)e.hasOwnProperty(r)||i.push("[/".concat(r,"]"));for(var r in e){var s=e[r];if(n[r]!==s)switch(r){case"size":i.push("[size=".concat(s.replace("px",""),"]"));break;case"color":case"weight":case"stroke":case"y":case"img":case"area":case"url":case"align":i.push("[".concat(r,"=").concat(s,"]"));break;case"u":!0===s?i.push("[u]"):i.push("[u=".concat(s,"]"));break;default:i.push("[".concat(r,"]"))}}return i.push(t),i.join("")}};Object.assign(se.prototype,ae);var oe=function(){s(o,Yt);var a=h(o);function o(t,e,n,i,r){y(this,o);var s=new se(r);return a.call(this,t,e,n,i,r,"rexBBCodeText",s)}return r(o,[{key:"setDelimiters",value:function(t,e){return this.parse.setDelimiters(t,e),this}}]),o}();function le(t,e,n,i){var r=new oe(this.scene,t,e,n,i);return this.scene.add.existing(r),r}var he=Phaser.Utils.Objects.GetAdvancedValue,ue=Phaser.GameObjects.BuildGameObject;function ce(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var n=he(t,"text",""),i=he(t,"style",null),r=he(t,"padding",null);null!==r&&(i.padding=r);var s=new oe(this.scene,0,0,n,i);return ue(this.scene,s,t),s.autoRound=he(t,"autoRound",!0),s}function de(t){return null==t||""===t||0===t.length}var fe=function(){s(i,Phaser.Plugins.BasePlugin);var n=h(i);function i(t){var e;return y(this,i),e=n.call(this,t),t.registerGameObject("rexBBCodeText",le,ce),e}return r(i,[{key:"start",value:function(){this.game.events.on("destroy",this.destroy,this)}}]),i}();return function(t,e,n,i){if(void 0===i&&(i="."),"object"===l(t)){if(de(e)){if(null==n)return;"object"===l(n)&&(t=n)}else{"string"==typeof e&&(e=e.split(i));var r=e.pop();(function(t,e,n){var i=t;if(!de(e)){var r;"string"==typeof e&&(e=e.split("."));for(var s=0,a=e.length;s<a;s++){var o;if(null==i[r=e[s]]||"object"!==l(i[r]))o=s!==a-1||void 0===n?{}:n,i[r]=o;i=i[r]}}return i})(t,e)[r]=n}}}(window,"RexPlugins.GameObjects.BBCodeText",oe),fe});
